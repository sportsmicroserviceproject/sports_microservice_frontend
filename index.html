<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Generator - Live Matches</title>

    <!-- Bootstrap for quick styling. Haters gonna hate -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Custom styles -->
    <style>
        .team-card {
            transition: transform 0.2s;
        }

        .team-card:hover {
            transform: translateY(-2px);
        }

        .match-result {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .score {
            font-size: 2rem;
            font-weight: bold;
        }

        .vs {
            color: #6c757d;
            font-size: 1.2rem;
        }
    </style>
</head>

<body class="bg-light">
    <div class="container py-5">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-5">âš½ Sports Generator</h1>
            </div>
        </div>

        <div class="row">
            <!-- Teams Section -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title mb-0">Available Teams</h3>
                    </div>
                    <div class="card-body">
                        <div id="teams-list" hx-get="https://sports-generator.mymh.dev/teams" hx-trigger="load"
                            hx-target="#teams-list">
                            <div class="text-center">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading teams...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Match Generator Section -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title mb-0">Generate Match</h3>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary btn-lg w-100 mb-3"
                            hx-post="https://sports-generator.mymh.dev/matches/generate" hx-target="#match-result"
                            hx-indicator="#match-loading">
                            ðŸŽ² Generate Random Match
                        </button>

                        <div id="match-loading" class="htmx-indicator text-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Generating match...</span>
                            </div>
                        </div>

                        <div id="match-result" class="mt-3">
                            <div class="text-muted text-center">
                                Click the button to generate a match!
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Matches Section -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title mb-0">Recent Matches</h3>
                    </div>
                    <div class="card-body">
                        <div id="recent-matches">
                            <div class="text-muted text-center">
                                Generate some matches to see them here!
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Transform teams JSON into HTML
        document.body.addEventListener('htmx:beforeSwap', function (evt) {
            if (evt.target.id === 'teams-list') {
                const teams = JSON.parse(evt.detail.xhr.responseText);
                const leagues = {};

                // Group by league
                teams.forEach(team => {
                    if (!leagues[team.league]) leagues[team.league] = [];
                    leagues[team.league].push(team);
                });

                // Generate HTML
                let html = '';
                Object.keys(leagues).forEach(league => {
                    html += `<h5 class="mt-3 mb-2">${league}</h5>`;
                    leagues[league].forEach(team => {
                        html += `
                            <div class="team-card badge bg-secondary me-2 mb-2 p-2">
                                ${team.name}
                            </div>
                        `;
                    });
                });

                evt.detail.xhr.responseText = html;
            }

            // Transform match result
            if (evt.target.id === 'match-result') {
                const match = JSON.parse(evt.detail.xhr.responseText);
                const html = `
                    <div class="match-result card border-success">
                        <div class="card-body text-center">
                            <div class="row align-items-center">
                                <div class="col-4">
                                    <strong>${match.homeTeam.name}</strong>
                                </div>
                                <div class="col-4">
                                    <span class="score text-primary">${match.homeScore}</span>
                                    <span class="vs mx-2">vs</span>
                                    <span class="score text-primary">${match.awayScore}</span>
                                </div>
                                <div class="col-4">
                                    <strong>${match.awayTeam.name}</strong>
                                </div>
                            </div>
                            <div class="mt-2">
                                <small class="text-muted">${match.league} â€¢ ${new Date(match.matchDate).toLocaleDateString()}</small>
                            </div>
                        </div>
                    </div>
                `;

                evt.detail.xhr.responseText = html;

                // Add to recent matches
                setTimeout(() => {
                    const recentMatches = document.getElementById('recent-matches');
                    if (recentMatches.innerHTML.includes('Generate some matches')) {
                        recentMatches.innerHTML = '';
                    }
                    recentMatches.insertAdjacentHTML('afterbegin', html);
                }, 100);
            }
        });
    </script>
</body>

</html>